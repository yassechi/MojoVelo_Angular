<div class="compagnie-form-page">
  <div class="mb-4 flex justify-content-between align-items-center">
    <div>
      <h1 style="font-family: 'Poppins', sans-serif; font-weight: 700; color: #1e3a8a">
        {{ isEdit ? 'Modifier la compagnie' : 'Créer une compagnie' }}
      </h1>
      <p class="text-600">Gestion d'une compagnie</p>
    </div>
    <p-button
      label="Retour"
      icon="pi pi-arrow-left"
      styleClass="p-button-text"
      (click)="goBack()"
    ></p-button>
  </div>

  <p-card>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <!-- Logo Upload -->
      <div class="field mb-4">
        <label class="block mb-2 font-semibold">Logo</label>
        <div class="flex align-items-center gap-3">
          @if (uploadedLogo) {
            <img
              [src]="uploadedLogo"
              alt="Logo"
              style="
                width: 100px;
                height: 100px;
                object-fit: contain;
                border: 1px solid #ddd;
                border-radius: 8px;
              "
            />
          }
          <p-fileUpload
            mode="basic"
            chooseLabel="Choisir un logo"
            accept="image/*"
            [maxFileSize]="1000000"
            (onSelect)="onUpload($event)"
            [auto]="true"
            chooseIcon="pi pi-upload"
          ></p-fileUpload>
        </div>
        <small class="text-600">Format : PNG, JPG (max 1MB)</small>
      </div>

      <!-- Nom -->
      <div class="field mb-4">
        <label for="name" class="block mb-2 font-semibold">Nom de la compagnie *</label>
        <input
          pInputText
          id="name"
          formControlName="name"
          placeholder="Ex: MojoVelo HQ"
          class="w-full"
          [class.ng-invalid]="name?.invalid && name?.touched"
        />
        @if (name?.invalid && name?.touched) {
          <small class="text-red-500">Le nom est requis</small>
        }
      </div>

      <!-- Code -->
      <div class="field mb-4">
        <label for="code" class="block mb-2 font-semibold">Code *</label>
        <input
          pInputText
          id="code"
          formControlName="code"
          placeholder="Ex: MOJO001"
          class="w-full"
          [class.ng-invalid]="code?.invalid && code?.touched"
        />
        @if (code?.invalid && code?.touched) {
          <small class="text-red-500">
            Le code est requis
          </small>
        }
      </div>

      <!-- Adresse -->
      <div class="field mb-4">
        <label for="address" class="block mb-2 font-semibold">Adresse *</label>
        <input
          pInputText
          id="address"
          formControlName="address"
          placeholder="Ex: 123 Rue Example"
          class="w-full"
          [class.ng-invalid]="address?.invalid && address?.touched"
        />
        @if (address?.invalid && address?.touched) {
          <small class="text-red-500">
            L'adresse est requise
          </small>
        }
      </div>

      <!-- Email Contact -->
      <div class="field mb-4">
        <label for="contactEmail" class="block mb-2 font-semibold">Email de contact *</label>
        <input
          pInputText
          id="contactEmail"
          type="email"
          formControlName="contactEmail"
          placeholder="Ex: contact@company.com"
          class="w-full"
          [class.ng-invalid]="contactEmail?.invalid && contactEmail?.touched"
        />
        @if (contactEmail?.invalid && contactEmail?.touched) {
          <small class="text-red-500">
            @if (contactEmail?.errors?.['required']) {
              <span>L'email est requis</span>
            }
            @if (contactEmail?.errors?.['email']) {
              <span>Format email invalide</span>
            }
          </small>
        }
      </div>

      <!-- Contact (Utilisateur responsable) -->
      <div class="field mb-4">
        <label for="idContact" class="block mb-2 font-semibold">Contact responsable *</label>
        <p-select
          id="idContact"
          formControlName="idContact"
          [options]="users"
          optionLabel="userName"
          optionValue="id"
          placeholder="Sélectionnez un contact"
          [filter]="true"
          filterBy="userName,email"
          [showClear]="true"
          styleClass="w-full"
          [loading]="loadingUsers"
        >
          <ng-template let-user pTemplate="item">
            <div class="flex align-items-center gap-2">
              <div>
                <div>{{ user.userName }}</div>
                <small class="text-600">{{ user.email }}</small>
              </div>
            </div>
          </ng-template>
        </p-select>
        @if (idContact?.invalid && idContact?.touched) {
          <small class="text-red-500">
            Le contact est requis
          </small>
        }
      </div>

      <!-- Email Autorisé -->
      <div class="field mb-4">
        <label for="emailAutorise" class="block mb-2 font-semibold">Domaine email autorisé *</label>
        <input
          pInputText
          id="emailAutorise"
          formControlName="emailAutorise"
          placeholder="Ex: @company.com"
          class="w-full"
          [class.ng-invalid]="emailAutorise?.invalid && emailAutorise?.touched"
        />
        <small class="text-600 block mt-1">
          Seuls les utilisateurs avec ce domaine pourront s'inscrire
        </small>
        @if (emailAutorise?.invalid && emailAutorise?.touched) {
          <small class="text-red-500">
            @if (emailAutorise?.errors?.['required']) {
              <span>Le domaine est requis</span>
            }
            @if (emailAutorise?.errors?.['pattern']) {
              <span>Format : @company.com</span>
            }
          </small>
        }
      </div>

      <!-- Actif -->
      <div class="field mb-4">
        <div class="flex align-items-center">
          <p-checkbox formControlName="isActif" [binary]="true" inputId="isActif"></p-checkbox>
          <label for="isActif" class="ml-2">Compagnie active</label>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex justify-content-end gap-2 mt-4">
        <p-button
          label="Annuler"
          icon="pi pi-times"
          styleClass="p-button-text"
          (click)="goBack()"
          [disabled]="loading"
        ></p-button>
        <p-button
          [label]="isEdit ? 'Modifier' : 'Créer'"
          icon="pi pi-check"
          (onClick)="onSubmit()"
          [loading]="loading"
          [disabled]="form.invalid"
        />
      </div>
    </form>
  </p-card>
</div>
