<div class="contrat-edit-container p-4">
  <p-toast></p-toast>

  <!-- Header -->
  <div class="mb-4 flex justify-content-between align-items-center">
    <div class="flex align-items-center gap-3">
      <p-button
        icon="pi pi-arrow-left"
        [text]="true"
        [rounded]="true"
        (onClick)="goBack()"
        pTooltip="Retour au détail"
      ></p-button>
      <div>
        <h1 style="font-family: 'Poppins', sans-serif; font-weight: 700; color: #1e3a8a; margin: 0;">
          Modifier le contrat
        </h1>
        <p class="text-600 m-0">Modification des informations du contrat</p>
      </div>
    </div>
  </div>

  <!-- Formulaire -->
  <p-card *ngIf="!loading">
    <form [formGroup]="contratForm" (ngSubmit)="onSubmit()">
      <div class="grid">
        <!-- Référence -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Référence *</label>
          <input
            type="text"
            pInputText
            formControlName="ref"
            class="w-full"
          />
        </div>

        <!-- Vélo -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Vélo *</label>
          <p-select
            formControlName="veloId"
            [options]="velos"
            optionLabel="marque"
            optionValue="id"
            placeholder="Sélectionnez un vélo"
            class="w-full"
            [style]="{'width': '100%'}"
          >
            <ng-template let-velo pTemplate="item">
              {{ velo.marque }} {{ velo.modele }} ({{ velo.numeroSerie }})
            </ng-template>
          </p-select>
        </div>

        <!-- Bénéficiaire -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Bénéficiaire *</label>
          <p-select
            formControlName="beneficiaireId"
            [options]="users"
            optionLabel="firstName"
            optionValue="id"
            placeholder="Sélectionnez un bénéficiaire"
            class="w-full"
            [style]="{'width': '100%'}"
          >
            <ng-template let-user pTemplate="item">
              {{ user.firstName }} {{ user.lastName }}
            </ng-template>
          </p-select>
        </div>

        <!-- Responsable RH -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Responsable RH *</label>
          <p-select
            formControlName="userRhId"
            [options]="users"
            optionLabel="firstName"
            optionValue="id"
            placeholder="Sélectionnez un responsable RH"
            class="w-full"
            [style]="{'width': '100%'}"
          >
            <ng-template let-user pTemplate="item">
              {{ user.firstName }} {{ user.lastName }}
            </ng-template>
          </p-select>
        </div>

        <!-- Date début -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Date début *</label>
          <p-datepicker
            formControlName="dateDebut"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            class="w-full"
            [style]="{'width': '100%'}"
          ></p-datepicker>
        </div>

        <!-- Date fin -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Date fin *</label>
          <p-datepicker
            formControlName="dateFin"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            class="w-full"
            [style]="{'width': '100%'}"
          ></p-datepicker>
        </div>

        <!-- Durée -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Durée (mois) *</label>
          <p-inputnumber
            formControlName="duree"
            class="w-full"
            [style]="{'width': '100%'}"
          ></p-inputnumber>
        </div>

        <!-- Loyer mensuel HT -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Loyer mensuel HT (€) *</label>
          <p-inputnumber
            formControlName="loyerMensuelHT"
            mode="decimal"
            [minFractionDigits]="2"
            class="w-full"
            [style]="{'width': '100%'}"
          ></p-inputnumber>
        </div>

        <!-- Statut -->
        <div class="col-12 md:col-6">
          <label class="block text-600 mb-2">Statut *</label>
          <p-select
            formControlName="statutContrat"
            [options]="statutOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Sélectionnez un statut"
            class="w-full"
            [style]="{'width': '100%'}"
          ></p-select>
        </div>
      </div>

      <!-- Boutons -->
      <div class="flex gap-2 justify-content-end mt-4">
        <p-button
          label="Annuler"
          severity="secondary"
          (onClick)="goBack()"
          type="button"
        ></p-button>
        <p-button
          label="Enregistrer"
          icon="pi pi-check"
          type="submit"
          [disabled]="contratForm.invalid"
        ></p-button>
      </div>
    </form>
  </p-card>

  <!-- Loading state -->
  <div *ngIf="loading" class="text-center py-8">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #1e3a8a;"></i>
    <p class="mt-3 text-600">Chargement...</p>
  </div>
</div>
