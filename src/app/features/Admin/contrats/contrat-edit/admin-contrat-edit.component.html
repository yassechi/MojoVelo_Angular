<div class="contrat-edit-container p-4">
  <p-toast></p-toast>

  <!-- Header -->
  <div class="mb-4 flex justify-content-between align-items-center">
    <div class="flex align-items-center gap-3">
      <p-button
        icon="pi pi-arrow-left"
        [text]="true"
        [rounded]="true"
        (onClick)="goBack()"
        pTooltip="Retour au d&eacute;tail"
      ></p-button>
      <div>
        <h1 style="font-family: 'Poppins', sans-serif; font-weight: 700; color: #1e3a8a; margin: 0;">
          Modifier le contrat
        </h1>
        <p class="text-600 m-0">Modification des informations du contrat</p>
      </div>
    </div>
  </div>

  <!-- Formulaire -->
  @if (!loading()) {
    <p-card>
      <form [formGroup]="contratForm" (ngSubmit)="onSubmit()">
        <div class="grid">
          <!-- R&eacute;f&eacute;rence -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">R&eacute;f&eacute;rence *</label>
            <input
              type="text"
              pInputText
              formControlName="ref"
              class="w-full"
            />
          </div>

          <!-- V&eacute;lo -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">V&eacute;lo *</label>
            <p-select
              formControlName="veloId"
              [options]="velos()"
              optionLabel="marque"
              optionValue="id"
              placeholder="S&eacute;lectionnez un v&eacute;lo"
              class="w-full"
              [style]="{ 'width': '100%' }"
            >
              <ng-template let-velo pTemplate="item">
                {{ velo.marque }} {{ velo.modele }} ({{ velo.numeroSerie }})
              </ng-template>
            </p-select>
          </div>

          <!-- B&eacute;n&eacute;ficiaire -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">B&eacute;n&eacute;ficiaire *</label>
            <p-select
              formControlName="beneficiaireId"
              [options]="users()"
              optionLabel="firstName"
              optionValue="id"
              placeholder="S&eacute;lectionnez un b&eacute;n&eacute;ficiaire"
              class="w-full"
              [style]="{ 'width': '100%' }"
            >
              <ng-template let-user pTemplate="item">
                {{ user.firstName }} {{ user.lastName }}
              </ng-template>
            </p-select>
          </div>

          <!-- Responsable RH -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Responsable RH *</label>
            <p-select
              formControlName="userRhId"
              [options]="users()"
              optionLabel="firstName"
              optionValue="id"
              placeholder="S&eacute;lectionnez un responsable RH"
              class="w-full"
              [style]="{ 'width': '100%' }"
            >
              <ng-template let-user pTemplate="item">
                {{ user.firstName }} {{ user.lastName }}
              </ng-template>
            </p-select>
          </div>

          <!-- Date d&eacute;but -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Date d&eacute;but *</label>
            <p-datepicker
              formControlName="dateDebut"
              dateFormat="dd/mm/yy"
              [showIcon]="true"
              class="w-full"
              [style]="{ 'width': '100%' }"
            ></p-datepicker>
          </div>

          <!-- Date fin -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Date fin *</label>
            <p-datepicker
              formControlName="dateFin"
              dateFormat="dd/mm/yy"
              [showIcon]="true"
              class="w-full"
              [style]="{ 'width': '100%' }"
            ></p-datepicker>
          </div>

          <!-- Dur&eacute;e -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Dur&eacute;e (mois) *</label>
            <p-inputnumber
              formControlName="duree"
              class="w-full"
              [style]="{ 'width': '100%' }"
            ></p-inputnumber>
          </div>

          <!-- Loyer mensuel HT -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Loyer mensuel HT (&euro;) *</label>
            <p-inputnumber
              formControlName="loyerMensuelHT"
              mode="decimal"
              [minFractionDigits]="2"
              class="w-full"
              [style]="{ 'width': '100%' }"
            ></p-inputnumber>
          </div>

          <!-- Statut -->
          <div class="col-12 md:col-6">
            <label class="block text-600 mb-2">Statut *</label>
            <p-select
              formControlName="statutContrat"
              [options]="statutOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="S&eacute;lectionnez un statut"
              class="w-full"
              [style]="{ 'width': '100%' }"
            ></p-select>
          </div>
        </div>

        <!-- Boutons -->
        <div class="flex gap-2 justify-content-end mt-4">
          <p-button
            label="Annuler"
            severity="secondary"
            (onClick)="goBack()"
            type="button"
          ></p-button>
          <p-button
            label="Enregistrer"
            icon="pi pi-check"
            type="submit"
            [disabled]="contratForm.invalid"
          ></p-button>
        </div>
      </form>
    </p-card>
  }

  <!-- Loading state -->
  @if (loading()) {
    <div class="text-center py-8">
      <i class="pi pi-spin pi-spinner" style="font-size: 3rem; color: #1e3a8a;"></i>
      <p class="mt-3 text-600">Chargement...</p>
    </div>
  }
</div>
