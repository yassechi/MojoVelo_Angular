<div class="register-shell">
  <p-toast></p-toast>

  <div class="register-card section-card">
    <div class="register-header">
      <div>
        <h1 class="register-title">Creer votre compte</h1>
        <p class="register-subtitle">
          Remplissez les informations ci-dessous pour creer votre compte utilisateur.
        </p>
      </div>
      <div class="register-badge">
        <i class="pi pi-user-plus"></i>
      </div>
    </div>

    <p class="register-note">Les champs marques * sont obligatoires.</p>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="register-form">
      <div class="register-grid">
        <div class="register-field">
          <label>Nom d'utilisateur *</label>
          <input pInputText formControlName="userName" class="w-full" />
          @if (form.get('userName')?.invalid && form.get('userName')?.touched) {
            <small class="field-error">Nom d'utilisateur requis.</small>
          }
        </div>

        <div class="register-field">
          <label>Email *</label>
          <input pInputText type="email" formControlName="email" class="w-full" />
          @if (form.get('email')?.invalid && form.get('email')?.touched) {
            <small class="field-error">
              @if (form.get('email')?.errors?.['required']) {
                <span>Email requis.</span>
              }
              @if (form.get('email')?.errors?.['email']) {
                <span>Format d'email invalide.</span>
              }
            </small>
          }
        </div>

        <div class="register-field">
          <label>Prenom *</label>
          <input pInputText formControlName="firstName" class="w-full" />
          @if (form.get('firstName')?.invalid && form.get('firstName')?.touched) {
            <small class="field-error">Prenom requis.</small>
          }
        </div>

        <div class="register-field">
          <label>Nom *</label>
          <input pInputText formControlName="lastName" class="w-full" />
          @if (form.get('lastName')?.invalid && form.get('lastName')?.touched) {
            <small class="field-error">Nom requis.</small>
          }
        </div>

        <div class="register-field">
          <label>Telephone *</label>
          <input pInputText formControlName="phoneNumber" class="w-full" />
          @if (form.get('phoneNumber')?.invalid && form.get('phoneNumber')?.touched) {
            <small class="field-error">Numero de telephone requis.</small>
          }
        </div>

        <div class="register-field">
          <label>Organisation *</label>
          @if (organisationLocked) {
            <div class="organisation-lock">
              <i class="pi pi-building"></i>
              <span>{{ organisationName || 'Organisation selectionnee' }}</span>
            </div>
          } @else {
            <p-select
              formControlName="organisationId"
              [options]="organisations"
              optionLabel="name"
              optionValue="id"
              class="w-full"
              placeholder="Selectionner"
            ></p-select>
          }
          @if (form.get('organisationId')?.invalid && form.get('organisationId')?.touched) {
            <small class="field-error">Organisation requise.</small>
          }
          @if (!loadingOrganisations && organisations.length === 0) {
            <small class="field-error">Aucune organisation disponible.</small>
          }
        </div>

        <div class="register-field">
          <label>Mot de passe *</label>
          <p-password
            formControlName="password"
            [toggleMask]="true"
            [feedback]="false"
            class="w-full"
            inputclass="w-full"
          ></p-password>
          @if (form.get('password')?.invalid && form.get('password')?.touched) {
            <small class="field-error">
              @if (form.get('password')?.errors?.['required']) {
                <span>Mot de passe requis.</span>
              }
              @if (form.get('password')?.errors?.['minlength']) {
                <span>Minimum 8 caracteres.</span>
              }
            </small>
          }
        </div>

        <div class="register-field">
          <label>Confirmer le mot de passe *</label>
          <p-password
            formControlName="confirmPassword"
            [toggleMask]="true"
            [feedback]="false"
            class="w-full"
            inputclass="w-full"
          ></p-password>
          @if (form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched) {
            <small class="field-error">
              @if (form.get('confirmPassword')?.errors?.['required']) {
                <span>Confirmation requise.</span>
              }
              @if (form.get('confirmPassword')?.errors?.['passwordMismatch']) {
                <span>Les mots de passe ne correspondent pas.</span>
              }
            </small>
          }
        </div>
      </div>

      <div class="register-actions">
        <p-button
          label="Enregistrer"
          type="submit"
          [loading]="loading"
          [disabled]="form.invalid || loading"
        ></p-button>
      </div>
    </form>
  </div>

  <div class="register-footer">
    <div class="footer-brand">Mojo</div>
    <div class="footer-links">
      <span>Accueil</span>
      <span>Accessoires</span>
      <span>Conditions generales</span>
      <span>Contact</span>
    </div>
  </div>
</div>

