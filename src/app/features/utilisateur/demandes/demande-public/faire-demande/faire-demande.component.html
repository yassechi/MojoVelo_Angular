<div class="demande-landing page-shell">
  <div class="page-header">
    <div>
      <h1 class="page-title">Faire une demande</h1>
      <p class="page-subtitle">Demandez une offre velo adaptee a votre entreprise</p>
    </div>
    @if (isAuthenticated) {
      <p-button
        label="Mes demandes"
        icon="pi pi-inbox"
        class="p-button-outlined"
        (click)="goToMesDemandes()"
      ></p-button>
    }
  </div>

  <div class="section-card precheck-card">
    <div class="precheck-header">
      <div class="precheck-icon">
        <i class="pi pi-building"></i>
      </div>
      <div class="precheck-text">
        <h2 class="precheck-title">Votre soci&eacute;t&eacute;</h2>
        <p class="precheck-subtitle">
          S&eacute;lectionnez votre entreprise d&eacute;j&agrave; enregistr&eacute;e.
        </p>
      </div>
    </div>
    <div class="precheck-body">
      <label class="block mb-2 font-semibold" for="organisationSelect">Soci&eacute;t&eacute;</label>
      <p-select
        id="organisationSelect"
        class="w-full precheck-select"
        [options]="organisationOptions"
        optionLabel="name"
        [filter]="true"
        filterBy="name,code,emailAutorise"
        [showClear]="true"
        placeholder="Rechercher une soci&eacute;t&eacute;"
        [(ngModel)]="organisation"
      >
        <ng-template pTemplate="item" let-org>
          <div class="organisation-option">
            <div class="organisation-name">{{ org.name }}</div>
            <small class="text-600">{{ org.emailAutorise }}</small>
          </div>
        </ng-template>
      </p-select>
      <div class="precheck-help">
        Votre soci&eacute;t&eacute; n'apparait pas ?
        <a class="precheck-email" [href]="supportMailto">Envoyer un email</a>
      </div>
      @if (loading) {
        <div class="text-600 text-sm">Chargement des societes...</div>
      }
      @if (!loading && organisationOptions.length === 0) {
        <div class="precheck-warning">
          <i class="pi pi-exclamation-triangle"></i>
          <span>Aucune societe disponible. Contactez-nous par email.</span>
        </div>
      }
      @if (!organisation && !loading && organisationOptions.length > 0) {
        <div class="precheck-warning">
          <i class="pi pi-exclamation-triangle"></i>
          <span>S&eacute;lectionnez votre soci&eacute;t&eacute; pour continuer.</span>
        </div>
      }
    </div>
  </div>

  @if (organisation; as org) {
  <div class="section-card hero-card">
    <div class="hero-grid">
      <div class="hero-brand">
        <div class="logo-shell">
          @if (org.logoUrl) {
            <img [src]="org.logoUrl" alt="Logo" />
          } @else {
            <div class="logo-fallback">
              <i class="pi pi-building"></i>
            </div>
          }
        </div>
        <div class="company-info">
          <div class="company-name">{{ org.name }}</div>
          <div class="company-domain">
            <span>Domaine: {{ org.emailAutorise }}</span>
          </div>
        </div>
      </div>

      <div class="hero-content">
        <h2 class="brand-title hero-title">
          Leasing V&eacute;lo pour le personnel de {{ org.name }}
        </h2>
        <p class="hero-subtitle">Dur&eacute;e 36 mois | Entretien et assurance inclus</p>
        <div class="hero-actions">
          <p-button
            [label]="isAuthenticated ? 'Demander une offre' : 'Se connecter'"
            icon="pi pi-arrow-right"
            (click)="onPrimaryAction()"
            [disabled]="!isAuthenticated && !organisation"
          ></p-button>
        </div>
        @if (loading) {
          <p class="hero-loading">Detection de la compagnie...</p>
        }
      </div>
    </div>
  </div>

  <div class="grid feature-grid">
    <div class="col-12 md:col-4">
      <div class="section-card feature-card">
        <div class="feature-icon">
          <i class="pi pi-wallet"></i>
        </div>
        <h3>Financement</h3>
        <p>Prise en charge via la prime de fin d'annee.</p>
      </div>
    </div>
    <div class="col-12 md:col-4">
      <div class="section-card feature-card">
        <div class="feature-icon">
          <i class="pi pi-shield"></i>
        </div>
        <h3>Services inclus</h3>
        <p>Entretien, assurance vol et degats, assistance 24/7.</p>
      </div>
    </div>
    <div class="col-12 md:col-4">
      <div class="section-card feature-card">
        <div class="feature-icon">
          <i class="pi pi-star"></i>
        </div>
        <h3>Large choix</h3>
        <p>Velos ville, cargo, course, VTT, electriques ou non.</p>
      </div>
    </div>
  </div>
  }
</div>

