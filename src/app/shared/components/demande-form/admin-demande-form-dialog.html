<div class="demande-form-page">
  <div class="mb-4 flex justify-content-between align-items-center">
    <div>
      <h1 style="font-family: 'Poppins', sans-serif; font-weight: 700; color: #1e3a8a">
        {{ isEdit ? 'Modifier la demande' : 'Créer une demande' }}
      </h1>
      <p class="text-600">Gestion d'une demande</p>
    </div>
    <p-button
      label="Retour"
      icon="pi pi-arrow-left"
      styleClass="p-button-text"
      (click)="goBack()"
    ></p-button>
  </div>

  <p-card>
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="grid">
        <!-- Utilisateur -->
        <div class="col-12">
          <div class="field mb-4">
            <label for="idUser" class="block mb-2 font-semibold">Utilisateur *</label>
            <p-select
              id="idUser"
              formControlName="idUser"
              [options]="users"
              optionLabel="userName"
              optionValue="id"
              placeholder="Sélectionnez un utilisateur"
              [filter]="true"
              filterBy="userName,email"
              [showClear]="true"
              styleClass="w-full"
            >
              <ng-template let-user pTemplate="item">
                <div class="flex flex-column">
                  <div>{{ user.userName }}</div>
                  <small class="text-600">{{ user.email }}</small>
                </div>
              </ng-template>
            </p-select>
            @if (form.get('idUser')?.invalid && form.get('idUser')?.touched) {
              <small class="p-error">
                L'utilisateur est obligatoire
              </small>
            }
          </div>
        </div>

        <!-- ID Vélo -->
        <div class="col-12 md:col-6">
          <div class="field mb-4">
            <label for="idVelo" class="block mb-2 font-semibold">ID Vélo *</label>
            <p-inputnumber
              id="idVelo"
              formControlName="idVelo"
              [min]="1"
              [useGrouping]="false"
              styleClass="w-full"
              placeholder="Ex: 1"
            ></p-inputnumber>
            @if (form.get('idVelo')?.invalid && form.get('idVelo')?.touched) {
              <small class="p-error">
                L'ID du vélo est obligatoire
              </small>
            }
          </div>
        </div>

        <!-- Statut -->
        <div class="col-12 md:col-6">
          <div class="field mb-4">
            <label for="status" class="block mb-2 font-semibold">Statut *</label>
            <p-select
              id="status"
              formControlName="status"
              [options]="statusOptions"
              optionLabel="label"
              optionValue="value"
              placeholder="Sélectionnez un statut"
              styleClass="w-full"
            ></p-select>
            @if (form.get('status')?.invalid && form.get('status')?.touched) {
              <small class="p-error">
                Le statut est obligatoire
              </small>
            }
          </div>
        </div>

        <!-- Discussion ID (optionnel) -->
        <div class="col-12">
          <div class="field mb-4">
            <label for="discussionId" class="block mb-2 font-semibold">ID Discussion (optionnel)</label>
            <p-inputnumber
              id="discussionId"
              formControlName="discussionId"
              [min]="1"
              [useGrouping]="false"
              styleClass="w-full"
              placeholder="Ex: 1"
            ></p-inputnumber>
          </div>
        </div>

        <!-- Actif -->
        <div class="col-12">
          <div class="field mb-4">
            <div class="flex align-items-center">
              <p-checkbox
                formControlName="isActif"
                [binary]="true"
                inputId="isActif"
              ></p-checkbox>
              <label for="isActif" class="ml-2">Demande active</label>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-content-end gap-2 mt-4">
        <p-button
          label="Annuler"
          icon="pi pi-times"
          [text]="true"
          (onClick)="goBack()"
          [disabled]="loading"
        ></p-button>
        <p-button
          [label]="isEdit ? 'Modifier' : 'Créer'"
          icon="pi pi-check"
          (onClick)="onSubmit()"
          [loading]="loading"
          [disabled]="form.invalid"
        ></p-button>
      </div>
    </form>
  </p-card>
</div>
